<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmseed: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmseed
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">The miniSEED data format library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#examples-overview">Overview</a></li>
<li class="level1"><a href="#example-mseedview">Read miniSEED from files</a></li>
<li class="level1"><a href="#example-lm_read_selection">Reading with selections</a></li>
<li class="level1"><a href="#example-lm_read_buffer">Reading from memory buffers</a></li>
<li class="level1"><a href="#example-lm_pack">Writing miniSEED</a></li>
<li class="level1"><a href="#example-lm_sids">Working with Source Identifiers</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="examples-overview"></a>
Overview</h1>
<p>The most basic usage of the library is illustrated in the <a class="el" href="page-tutorial.html">Tutorial</a>. This page contains full example programs that utilize the library for common tasks. These examples are included in the source distribution and (most) are used in the test suite.</p>
<p>While these are full working programs the aspects not related to library usage, e.g. argument parsing, are often minimized and left uncommented as they will change in real world usage.</p>
<h1><a class="anchor" id="example-mseedview"></a>
Read miniSEED from files</h1>
<p>A simple program to read miniSEED from files and print details from each record:</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * A simple example of using libmseed to read miniSEED.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Opens a user specified file, parses the miniSEED records and prints</span></div><div class="line"><span class="comment"> * details for each record.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2019 Chad Trabant, IRIS Data Management Center</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is free software; you can redistribute it</span></div><div class="line"><span class="comment"> * and/or modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 3 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is distributed in the hope that it will be</span></div><div class="line"><span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span></div><div class="line"><span class="comment"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU Lesser General Public License (GNU-LGPL) for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this software. If not, see</span></div><div class="line"><span class="comment"> * &lt;https://www.gnu.org/licenses/&gt;</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot; LIBMSEED_VERSION &quot; example]&quot;</span></div><div class="line"><span class="preprocessor">#define PACKAGE &quot;mseedview&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> int8_t verbose = 0;</div><div class="line"><span class="keyword">static</span> int8_t ppackets = 0;</div><div class="line"><span class="keyword">static</span> int8_t basicsum = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> printdata = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *inputfile = 0;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage (<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <a class="code" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = 0;</div><div class="line">  uint32_t flags = 0;</div><div class="line"></div><div class="line">  int64_t totalrecs = 0;</div><div class="line">  int64_t totalsamps = 0;</div><div class="line">  <span class="keywordtype">int</span> retcode;</div><div class="line"></div><div class="line">  <span class="comment">/* Process given parameters (command line and parameter file) */</span></div><div class="line">  <span class="keywordflow">if</span> (parameter_proc (argc, argv) &lt; 0)</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">  <span class="comment">/* Set flag to validate CRCs when reading */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Set flag to unpack data if printing samples */</span></div><div class="line">  <span class="keywordflow">if</span> (printdata)</div><div class="line">    flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Loop over the input file record by record */</span></div><div class="line">  <span class="keywordflow">while</span> ((retcode = <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, inputfile, NULL, NULL,</div><div class="line">                                 flags, verbose)) == <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">  {</div><div class="line">    totalrecs++;</div><div class="line">    totalsamps += msr-&gt;<a class="code" href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">samplecnt</a>;</div><div class="line"></div><div class="line">    <a class="code" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, ppackets);</div><div class="line"></div><div class="line">    <span class="comment">/* Print data samples */</span></div><div class="line">    <span class="keywordflow">if</span> (printdata &amp;&amp; msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> &gt; 0)</div><div class="line">    {</div><div class="line">      <span class="keywordtype">int</span> line, col, cnt, samplesize;</div><div class="line">      <span class="keywordtype">int</span> lines = (msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> / 6) + 1;</div><div class="line">      <span class="keywordtype">void</span> *sptr;</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> ((samplesize = <a class="code" href="group__utility-functions.html#ga7595a7a94a4394418106d69b96e318f2">ms_samplesize</a> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>)) == 0)</div><div class="line">      {</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unrecognized sample type: &#39;%c&#39;\n&quot;</span>, msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>);</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keywordflow">for</span> (cnt = 0, line = 0; line &lt; lines; line++)</div><div class="line">      {</div><div class="line">        <span class="keywordflow">for</span> (col = 0; col &lt; 6; col++)</div><div class="line">        {</div><div class="line">          <span class="keywordflow">if</span> (cnt &lt; msr-&gt;numsamples)</div><div class="line">          {</div><div class="line">            sptr = (<span class="keywordtype">char</span> *)msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> + (cnt * samplesize);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;i&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10d  &quot;</span>, *(int32_t *)sptr);</div><div class="line"></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;f&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10.8g  &quot;</span>, *(<span class="keywordtype">float</span> *)sptr);</div><div class="line"></div><div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> == <span class="charliteral">&#39;d&#39;</span>)</div><div class="line">              <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;%10.10g  &quot;</span>, *(<span class="keywordtype">double</span> *)sptr);</div><div class="line"></div><div class="line">            cnt++;</div><div class="line">          }</div><div class="line">        }</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">/* If only printing the first 6 samples break out here */</span></div><div class="line">        <span class="keywordflow">if</span> (printdata == 1)</div><div class="line">          <span class="keywordflow">break</span>;</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read %s: %s\n&quot;</span>, inputfile, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a> (retcode));</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, NULL, NULL, NULL, 0, 0);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (basicsum)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Records: %&quot;</span> PRId64 <span class="stringliteral">&quot;, Samples: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line">            totalrecs, totalsamps);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of main() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * parameter_proc():</span></div><div class="line"><span class="comment"> * Process the command line parameters.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Returns 0 on success, and -1 on failure</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec)</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> optind;</div><div class="line"></div><div class="line">  <span class="comment">/* Process all command line arguments */</span></div><div class="line">  <span class="keywordflow">for</span> (optind = 1; optind &lt; argcount; optind++)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-V&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-h&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      usage ();</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      verbose += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;v&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-p&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      ppackets += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;p&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-d&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      printdata = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-D&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      printdata = 2;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-s&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      basicsum = 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-&quot;</span>, 1) == 0 &amp;&amp;</div><div class="line">             strlen (argvec[optind]) &gt; 1)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div><div class="line">      exit (1);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inputfile == 0)</div><div class="line">    {</div><div class="line">      inputfile = argvec[optind];</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div><div class="line">      exit (1);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure an inputfile was specified */</span></div><div class="line">  <span class="keywordflow">if</span> (!inputfile)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;No input file was specified\n\n&quot;</span>);</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version %s\n\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Try %s -h for usage\n&quot;</span>, PACKAGE);</div><div class="line">    exit (1);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Report the program version */</span></div><div class="line">  <span class="keywordflow">if</span> (verbose)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of parameter_proc() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * usage():</span></div><div class="line"><span class="comment"> * Print the usage message and exit.</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">usage (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s version: %s\n\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Usage: %s [options] file\n\n&quot;</span>, PACKAGE);</div><div class="line">  fprintf (stderr,</div><div class="line">           <span class="stringliteral">&quot; ## Options ##\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -V             Report program version\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -h             Show this usage message\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -v             Be more verbose, multiple flags can be used\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -p             Print details of header, multiple flags can be used\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -d             Print first 6 sample values\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -D             Print all sample values\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -s             Print a basic summary after processing a file\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; file           File of miniSEED records\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">} <span class="comment">/* End of usage() */</span></div></div><!-- fragment --><h1><a class="anchor" id="example-lm_read_selection"></a>
Reading with selections</h1>
<p>Read miniSEED with <a class="el" href="group__data-selections.html">Data Selections</a> used to limit what is read. Additionally, this program reads data into a <a class="el" href="group__trace-list.html">Trace List</a> and illustrates traversing the entries.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * A program for reading miniSEED using data selections to limit which</span></div><div class="line"><span class="comment"> * data is read.  This program also illustrates traversing a trace</span></div><div class="line"><span class="comment"> * list.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2019 Chad Trabant, IRIS Data Management Center</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is free software; you can redistribute it</span></div><div class="line"><span class="comment"> * and/or modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 3 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is distributed in the hope that it will be</span></div><div class="line"><span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span></div><div class="line"><span class="comment"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU Lesser General Public License (GNU-LGPL) for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this software. If not, see</span></div><div class="line"><span class="comment"> * &lt;https://www.gnu.org/licenses/&gt;</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <a class="code" href="group__data-selections.html#struct_m_s3_selections">MS3Selections</a> *selections = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_i_d">MS3TraceID</a> *tid = NULL;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_seg">MS3TraceSeg</a> *seg = NULL;</div><div class="line"></div><div class="line">  <span class="keywordtype">char</span> *mseedfile = NULL;</div><div class="line">  <span class="keywordtype">char</span> *selectionfile = NULL;</div><div class="line">  <span class="keywordtype">char</span> starttimestr[30];</div><div class="line">  <span class="keywordtype">char</span> endtimestr[30];</div><div class="line">  uint32_t flags = 0;</div><div class="line">  int8_t verbose = 0;</div><div class="line">  <span class="keywordtype">int</span> rv;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (argc != 3)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Usage: %s &lt;mseedfile&gt; &lt;selectionfile&gt;\n&quot;</span>,argv[0]);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  mseedfile = argv[1];</div><div class="line">  selectionfile = argv[2];</div><div class="line"></div><div class="line">  <span class="comment">/* Read data selections from specified file */</span></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__data-selections.html#gaf8aa9de2cbbc18bc96fe3c4f0dfcb92d">ms3_readselectionsfile</a> (&amp;selections, selectionfile) &lt; 0)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read data selection file\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line">  flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Read all miniSEED into a trace list, limiting to selections */</span></div><div class="line">  rv = <a class="code" href="group__io-functions.html#gae0cba40ee8021bcb8bcd3b35042f7b02">ms3_readtracelist_selection</a> (&amp;mstl, mseedfile, -1.0, -1.0,</div><div class="line">                                    selections, 0, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (rv != <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read miniSEED from file: %s\n&quot;</span>, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a>(rv));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Traverse trace list structures and print summary information */</span></div><div class="line">  tid = mstl-&gt;<a class="code" href="group__trace-list.html#a4dddb7dd95226889820e4e8046c8bcb8">traces</a>;</div><div class="line">  <span class="keywordflow">while</span> (tid)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (tid-&gt;<a class="code" href="group__trace-list.html#a537e76409176bd8fca77a71e73b825fb">earliest</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div><div class="line">        !<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (tid-&gt;<a class="code" href="group__trace-list.html#a3464b9217cd83f1c8a1527ac2384ff63">latest</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div><div class="line">      starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;TraceID for %s (%d), earliest: %s, latest: %s, segments: %d\n&quot;</span>,</div><div class="line">            tid-&gt;<a class="code" href="group__trace-list.html#aaa4e9d9d9fb4c2bf4f93472500744c52">sid</a>, tid-&gt;<a class="code" href="group__trace-list.html#a49a7a751c8f59f769ec3b6e29e8aacfd">pubversion</a>, starttimestr, endtimestr, tid-&gt;<a class="code" href="group__trace-list.html#afdbdeb4baba7b1b2bbdb92738344b70c">numsegments</a>);</div><div class="line"></div><div class="line">    seg = tid-&gt;<a class="code" href="group__trace-list.html#a2c57e9aa2e2b922b57df9ea8031aebde">first</a>;</div><div class="line">    <span class="keywordflow">while</span> (seg)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (!<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (seg-&gt;<a class="code" href="group__trace-list.html#afa4b2623a8ffb336a9d9d9a9773c0dc0">starttime</a>, starttimestr, SEEDORDINAL, NANO_MICRO_NONE) ||</div><div class="line">          !<a class="code" href="group__time-related.html#gad7cff6478f345e41e5c25b45d9f3757b">ms_nstime2timestr</a> (seg-&gt;<a class="code" href="group__trace-list.html#a2c33217da025db4c975c4013629d53eb">endtime</a>, endtimestr, SEEDORDINAL, NANO_MICRO_NONE))</div><div class="line">      {</div><div class="line">        <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot create time strings\n&quot;</span>);</div><div class="line">        starttimestr[0] = endtimestr[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line">      }</div><div class="line"></div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;  Segment %s - %s, samples: %d, sample rate: %g, sample type: %c\n&quot;</span>,</div><div class="line">              starttimestr, endtimestr, seg-&gt;<a class="code" href="group__trace-list.html#a04a949bf1a75ed3008e22243922fe53c">numsamples</a>, seg-&gt;<a class="code" href="group__trace-list.html#acb10e4263b0aeaab66232c35d8c7d5ac">samprate</a>, seg-&gt;<a class="code" href="group__trace-list.html#a9addbbe3f6cbb7f742b8def029cde74e">sampletype</a>);</div><div class="line"></div><div class="line">      seg = seg-&gt;<a class="code" href="group__trace-list.html#ad5acfe831d046c60102414e333cb46a3">next</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    tid = tid-&gt;<a class="code" href="group__trace-list.html#a7010e1a21bb73ccf12c5bbd783bfc9da">next</a>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <span class="keywordflow">if</span> (mstl)</div><div class="line">    <a class="code" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (selections)</div><div class="line">    <a class="code" href="group__data-selections.html#ga63f765d5d879a6e9c065e56c47a9d053">ms3_freeselections</a> (selections);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="example-lm_read_buffer"></a>
Reading from memory buffers</h1>
<p>Read miniSEED from memory buffers. In this case a file is read into a buffer simply to illustrate reading from a buffer. In practice this would functionality would be used with data received via a network connection or some other, non-file, mechanism.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * A program illustrating reading miniSEED from buffers</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2019 Chad Trabant, IRIS Data Management Center</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is free software; you can redistribute it</span></div><div class="line"><span class="comment"> * and/or modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 3 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is distributed in the hope that it will be</span></div><div class="line"><span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span></div><div class="line"><span class="comment"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU Lesser General Public License (GNU-LGPL) for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this software. If not, see</span></div><div class="line"><span class="comment"> * &lt;https://www.gnu.org/licenses/&gt;</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <span class="keyword">struct </span>stat sb = {0};</div><div class="line">  int64_t records = 0;</div><div class="line">  FILE *fh;</div><div class="line"></div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div><div class="line">  <span class="keywordtype">char</span> *buffer = NULL;</div><div class="line">  uint64_t bufferlength = 0;</div><div class="line">  <span class="keywordtype">double</span> timetol = -1;</div><div class="line">  <span class="keywordtype">double</span> sampratetol = -1;</div><div class="line">  int8_t splitversion = 0;</div><div class="line">  uint32_t flags = 0;</div><div class="line">  int8_t verbose = 0;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (argc != 2)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;%s requires a single file name argument\n&quot;</span>,argv[0]);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Read specified file into buffer */</span></div><div class="line">  <span class="keywordflow">if</span> (!(fh = fopen(argv[1], <span class="stringliteral">&quot;rb&quot;</span>)))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error opening %s: %s\n&quot;</span>, argv[1], strerror(errno));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (fstat (fileno(fh), &amp;sb))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error stating %s: %s\n&quot;</span>, argv[1], strerror(errno));</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (!(buffer = (<span class="keywordtype">char</span> *)malloc(sb.st_size)))</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating buffer of %lld bytes\n&quot;</span>, (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)sb.st_size);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (fread(buffer, sb.st_size, 1, fh) != 1)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error reading file\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  fclose(fh);</div><div class="line"></div><div class="line">  bufferlength = sb.st_size;</div><div class="line"></div><div class="line">  <span class="comment">/* Set bit flags to validate CRC and unpack data samples */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gab06edaad68767eb4f5603d3fcb3eeb13">MSF_VALIDATECRC</a>;</div><div class="line">  flags |= <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line"></div><div class="line">  mstl = <a class="code" href="group__trace-list.html#ga45e73d09fd22076373540407d45d1f6a">mstl3_init</a> (NULL);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (!mstl)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error allocating MS3TraceList\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Read all miniSEED in buffer, accumulate in MS3TraceList */</span></div><div class="line">  records = <a class="code" href="group__trace-list.html#ga592d4a0909d6961f745098a556635b8f">mstl3_readbuffer</a> (&amp;mstl, buffer, bufferlength, timetol,</div><div class="line">                              sampratetol, splitversion, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (records &lt; 0)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Problem reading miniSEED from buffer: %s\n&quot;</span>, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a>(records));</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Print summary */</span></div><div class="line">  <a class="code" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a> (mstl, ISOMONTHDAY, 1, 1);</div><div class="line"></div><div class="line">  <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Total records: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, records);</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <span class="keywordflow">if</span> (mstl)</div><div class="line">    <a class="code" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 0);</div><div class="line"></div><div class="line">  free (buffer);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="example-lm_pack"></a>
Writing miniSEED</h1>
<p>An example of creating miniSEED. Static data with known signal is used for input for illustration and testing.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * A program for libmseed packing tests.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2019 Chad Trabant, IRIS Data Management Center</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is free software; you can redistribute it</span></div><div class="line"><span class="comment"> * and/or modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 3 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is distributed in the hope that it will be</span></div><div class="line"><span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span></div><div class="line"><span class="comment"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU Lesser General Public License (GNU-LGPL) for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this software. If not, see</span></div><div class="line"><span class="comment"> * &lt;https://www.gnu.org/licenses/&gt;</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define VERSION &quot;[libmseed &quot; LIBMSEED_VERSION &quot; example]&quot;</span></div><div class="line"><span class="preprocessor">#define PACKAGE &quot;lm_pack&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <a class="code" href="libmseed_8h.html#a2fa2d4ca679cdb79cfa01c1cc94a7298">flag</a> verbose  = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> reclen    = -1;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> encoding  = -1;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> byteorder = -1;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *outfile = NULL;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> print_stderr (<span class="keywordtype">char</span> *message);</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> usage (<span class="keywordtype">void</span>);</div><div class="line"></div><div class="line"><span class="comment">/* A simple, expanding sinusoid of 500 samples.</span></div><div class="line"><span class="comment"> * For all samples, no successive difference is greater than 30 bits (signed).</span></div><div class="line"><span class="comment"> *   - Good for INT32, STEIM1, STEIM2, etc.</span></div><div class="line"><span class="comment"> * Between index 0-400, no sample value is greater than 16 bits (signed).</span></div><div class="line"><span class="comment"> *   - Good for INT16.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> int32_t sindata[500] =</div><div class="line">    {0, 2, 4, 5, 7, 9, 10, 11, 11, 11, 11, 10, 8, 6, 4, 1, 0, -3,</div><div class="line">     -6, -8, -11, -13, -14, -15, -16, -15, -14, -13, -11, -8, -5,</div><div class="line">     -1, 2, 6, 9, 13, 16, 18, 20, 21, 22, 21, 19, 17, 14, 10, 5, 0,</div><div class="line">     -4, -9, -14, -19, -23, -26, -29, -30, -30, -29, -26, -22, -18,</div><div class="line">     -12, -5, 1, 8, 15, 22, 28, 33, 38, 40, 41, 41, 39, 35, 29, 22,</div><div class="line">     14, 5, -4, -14, -24, -33, -41, -48, -53, -56, -57, -56, -52, -46,</div><div class="line">     -38, -27, -16, -3, 10, 23, 37, 49, 60, 68, 75, 78, 78, 75, 69, 60,</div><div class="line">     48, 33, 17, 0, -19, -38, -56, -72, -86, -97, -104, -108, -107,</div><div class="line">     -102, -92, -78, -60, -39, -16, 8, 34, 59, 83, 105, 123, 137, 146,</div><div class="line">     149, 146, 137, 122, 101, 75, 45, 12, -22, -57, -92, -124, -152,</div><div class="line">     -175, -192, -202, -204, -198, -183, -160, -129, -92, -50, -3, 44,</div><div class="line">     93, 139, 182, 219, 249, 269, 280, 279, 267, 243, 208, 164, 110, 50,</div><div class="line">     -13, -80, -146, -209, -266, -314, -352, -376, -386, -380, -359,</div><div class="line">     -322, -270, -205, -128, -44, 45, 137, 227, 311, 386, 449, 495, 523,</div><div class="line">     530, 516, 480, 423, 346, 252, 144, 25, -99, -225, -347, -460, -558,</div><div class="line">     -637, -694, -724, -726, -698, -640, -553, -440, -305, -151, 15, 187,</div><div class="line">     359, 524, 673, 801, 902, 969, 999, 990, 939, 848, 718, 554, 359,</div><div class="line">     142, -89, -327, -561, -782, -980, -1145, -1271, -1349, -1375, -1346,</div><div class="line">     -1260, -1118, -925, -686, -409, -104, 218, 544, 862, 1157, 1417,</div><div class="line">     1629, 1784, 1871, 1885, 1822, 1681, 1466, 1181, 836, 443, 15, -430,</div><div class="line">     -877, -1306, -1700, -2039, -2309, -2495, -2586, -2575, -2457, -2233,</div><div class="line">     -1909, -1492, -997, -441, 156, 771, 1381, 1958, 2479, 2920, 3259,</div><div class="line">     3478, 3562, 3504, 3300, 2951, 2467, 1861, 1154, 371, -460, -1306,</div><div class="line">     -2134, -2908, -3595, -4162, -4582, -4830, -4890, -4752, -4413,</div><div class="line">     -3878, -3162, -2286, -1281, -181, 971, 2131, 3252, 4285, 5184, 5908,</div><div class="line">     6418, 6686, 6690, 6419, 5874, 5064, 4013, 2753, 1329, -208, -1801,</div><div class="line">     -3385, -4896, -6268, -7438, -8351, -8959, -9223, -9120, -8637,</div><div class="line">     -7779, -6566, -5034, -3231, -1221, 921, 3114, 5270, 7298, 9110,</div><div class="line">     10622, 11760, 12462, 12680, 12386, 11571, 10247, 8447, 6225, 3657,</div><div class="line">     832, -2143, -5153, -8076, -10787, -13167, -15103, -16499, -17274,</div><div class="line">     -17372, -16759, -15432, -13417, -10766, -7564, -3920, 36, 4153, 8270,</div><div class="line">     12217, 15825, 18930, 21386, 23065, 23864, 23716, 22587, 20483, 17450,</div><div class="line">     13576, 8983, 3832, -1687, -7367, -12977, -18286, -23061, -27086,</div><div class="line">     -30164, -32129, -32855, -32260, -30315, -27044, -22526, -16897,</div><div class="line">     -10341, -3089, 4587, 12392, 20010, 27120, 33408, 38583, 42385, 44602,</div><div class="line">     45078, 43720, 40510, 35502, 28830, 20697, 11378, 1207, -9432, -20123,</div><div class="line">     -30427, -39906, -48136, -54727, -59340, -61705, -61632, -59023,</div><div class="line">     -53880, -46311, -36527, -24838, -11646, 2567, 17262, 31853, 45737,</div><div class="line">     58314, 69012, 77316, 82784, 85076, 83966, 79360, 71301, 59981, 45728,</div><div class="line">     29009, 10408, -9387, -29613, -49456, -68085, -84684, -98487, -108811,</div><div class="line">     -115090, -116897, -113975, -106249, -93837, -77057, -56418, -32610,</div><div class="line">     -6480, 20993, 48737, 75622, 100508, 122289, 139942, 152573, 159453,</div><div class="line">     160065, 154123, 141602, 122746, 98068, 68342, 34581, -1992, -39992,</div><div class="line">     -77915, -114200, -147287, -175686, -198036, -213168, -220164,</div><div class="line">     -218401, -207588, -187799, -159476};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *textdata =</div><div class="line">    <span class="stringliteral">&quot;I&#39;ve seen things you people wouldn&#39;t believe. Attack ships on fire off the shoulder of Orion. &quot;</span></div><div class="line">    <span class="stringliteral">&quot;I watched C-beams glitter in the dark near the Tannhäuser Gate. All those moments will be lost &quot;</span></div><div class="line">    <span class="stringliteral">&quot;in time, like tears...in...rain. Time to die.&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">/* Binary I/O for Windows platforms */</span></div><div class="line"><span class="preprocessor">#ifdef LMP_WIN</span></div><div class="line"><span class="preprocessor">  #include &lt;fcntl.h&gt;</span></div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> _CRT_fmode = _O_BINARY;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <a class="code" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div><div class="line">  <span class="keywordtype">float</span> *fdata  = NULL;</div><div class="line">  <span class="keywordtype">double</span> *ddata = NULL;</div><div class="line">  uint32_t flags = 0;</div><div class="line">  <span class="keywordtype">int</span> idx;</div><div class="line">  <span class="keywordtype">int</span> rv;</div><div class="line"></div><div class="line">  <span class="comment">/* Redirect libmseed logging facility to stderr for consistency */</span></div><div class="line">  <a class="code" href="group__logging.html#ga53b73052d7d37f563a054602eb6c1348">ms_loginit</a> (print_stderr, NULL, print_stderr, NULL);</div><div class="line"></div><div class="line">  <span class="comment">/* Process given parameters (command line and parameter file) */</span></div><div class="line">  <span class="keywordflow">if</span> (parameter_proc (argc, argv) &lt; 0)</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (!(msr = <a class="code" href="group__miniseed-record.html#ga23234c20f2e74e5c065d2b654a6602e5">msr3_init</a> (msr)))</div><div class="line">  {</div><div class="line">    fprintf (stderr, <span class="stringliteral">&quot;Could not allocate MS3Record, out of memory?\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Set up record parameters */</span></div><div class="line">  strcpy (msr-&gt;<a class="code" href="group__miniseed-record.html#ac93add454993eff521bc94900bf40ac1">sid</a>, <span class="stringliteral">&quot;XFDSN:XX_TEST__L_H_Z&quot;</span>);</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a47d7e72d144305b788d69e3ba859f087">reclen</a> = reclen;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#aef0f37c7df7a014ff18c123187cda1b6">pubversion</a> = 1;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a8ed5d39b9df3bfa9dd953c33d27ac73e">starttime</a> = <a class="code" href="group__time-related.html#gaa9fb97cc8dc5d8b94f2b0e6f663c950c">ms_timestr2nstime</a> (<span class="stringliteral">&quot;2012-01-01T00:00:00&quot;</span>);</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a7578e312e666fcc80cc07fd324201d4e">samprate</a> = 1.0;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a63ee8e965be55863765c56016873be17">encoding</a> = encoding;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (encoding == <a class="code" href="group__encoding-values.html#ga0e4d3b0ef76ca9b3e19b2b9f597bc539">DE_ASCII</a>)</div><div class="line">  {</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = strlen (textdata);</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = textdata;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;a&#39;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code" href="group__encoding-values.html#ga131dc4aeb13edcbd54dc80f14315cb28">DE_FLOAT32</a>)</div><div class="line">  {</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> = 500;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!(fdata = (<span class="keywordtype">float</span> *)malloc (msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> * sizeof (<span class="keywordtype">float</span>))))</div><div class="line">    {</div><div class="line">      fprintf (stderr, <span class="stringliteral">&quot;Could not allocate buffer, out of memory?\n&quot;</span>);</div><div class="line">      <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>; idx++)</div><div class="line">    {</div><div class="line">      fdata[idx] = (float)sindata[idx];</div><div class="line">    }</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = fdata;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;f&#39;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code" href="group__encoding-values.html#ga25685778ab9a5295f3f15313f515820b">DE_FLOAT64</a>)</div><div class="line">  {</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> = 500;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!(ddata = (<span class="keywordtype">double</span> *)malloc (msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> * sizeof (<span class="keywordtype">double</span>))))</div><div class="line">    {</div><div class="line">      fprintf (stderr, <span class="stringliteral">&quot;Could not allocate buffer, out of memory?\n&quot;</span>);</div><div class="line">      <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">for</span> (idx = 0; idx &lt; msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>; idx++)</div><div class="line">    {</div><div class="line">      ddata[idx] = (double)sindata[idx];</div><div class="line">    }</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = ddata;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;d&#39;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (encoding == <a class="code" href="group__encoding-values.html#gab435f469f14c9423949f7faa644f3830">DE_INT16</a>)</div><div class="line">  {</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = 400; <span class="comment">/* The first 400 samples can be represented in 16-bits */</span></div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = sindata;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;i&#39;</span>;</div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>  = 500;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = sindata;</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a>  = <span class="charliteral">&#39;i&#39;</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a85d0d5f365d50df0490d944dffdb3853">samplecnt</a> = msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a>;</div><div class="line"></div><div class="line">  <span class="comment">/* Set data flush flag */</span></div><div class="line">  flags |= <a class="code" href="group__control-flags.html#gaae2d9bb856575a556a4ac4dd1ce5f8c5">MSF_FLUSHDATA</a>;</div><div class="line"></div><div class="line">  rv = <a class="code" href="group__io-functions.html#ga4614ddc9bd829c497dc12d52f7157af4">msr3_writemseed</a> (msr, outfile, 1, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (rv &lt; 0)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Error (%d) writing miniSEED to %s\n&quot;</span>, rv, outfile);</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure everything is cleaned up */</span></div><div class="line">  <span class="keywordflow">if</span> (msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> == sindata || msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> == textdata)</div><div class="line">    msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = NULL;</div><div class="line">  <a class="code" href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a> (&amp;msr);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of main() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * parameter_proc:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Process the command line parameters.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Returns 0 on success, and -1 on failure</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div><div class="line">parameter_proc (<span class="keywordtype">int</span> argcount, <span class="keywordtype">char</span> **argvec)</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> optind;</div><div class="line"></div><div class="line">  <span class="comment">/* Process all command line arguments */</span></div><div class="line">  <span class="keywordflow">for</span> (optind = 1; optind &lt; argcount; optind++)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-V&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-h&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      usage ();</div><div class="line">      exit (0);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (argvec[optind], <span class="stringliteral">&quot;-v&quot;</span>, 2) == 0)</div><div class="line">    {</div><div class="line">      verbose += strspn (&amp;argvec[optind][1], <span class="stringliteral">&quot;v&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-r&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      reclen = strtol (argvec[++optind], NULL, 10);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-e&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      encoding = strtol (argvec[++optind], NULL, 10);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-b&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      byteorder = strtol (argvec[++optind], NULL, 10);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argvec[optind], <span class="stringliteral">&quot;-o&quot;</span>) == 0)</div><div class="line">    {</div><div class="line">      outfile = argvec[++optind];</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argvec[optind]);</div><div class="line">      exit (1);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Make sure an outfile was specified */</span></div><div class="line">  <span class="keywordflow">if</span> (!outfile)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;No output file was specified\n\n&quot;</span>);</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;Try %s -h for usage\n&quot;</span>, PACKAGE);</div><div class="line">    exit (1);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Report the program version */</span></div><div class="line">  <span class="keywordflow">if</span> (verbose)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (1, <span class="stringliteral">&quot;%s version: %s\n&quot;</span>, PACKAGE, VERSION);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">} <span class="comment">/* End of parameter_proc() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * print_stderr():</span></div><div class="line"><span class="comment"> * Print messsage to stderr.</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">print_stderr (<span class="keywordtype">char</span> *message)</div><div class="line">{</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s&quot;</span>, message);</div><div class="line">} <span class="comment">/* End of print_stderr() */</span></div><div class="line"></div><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * usage:</span></div><div class="line"><span class="comment"> * Print the usage message and exit.</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line">usage (<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;%s version: %s\n\n&quot;</span>, PACKAGE, VERSION);</div><div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Usage: %s [options] -o outfile\n\n&quot;</span>, PACKAGE);</div><div class="line">  fprintf (stderr,</div><div class="line">           <span class="stringliteral">&quot; ## Options ##\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -V             Report program version\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -h             Show this usage message\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -v             Be more verbose, multiple flags can be used\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -r bytes       Specify maximum record length in bytes, default 4096\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -e encoding    Specify encoding format\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -b byteorder   Specify byte order for packing, MSBF: 1, LSBF: 0\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot; -o outfile     Specify the output file, required\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;This program packs static, test data into miniSEED\n&quot;</span></div><div class="line">           <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">} <span class="comment">/* End of usage() */</span></div></div><!-- fragment --><h1><a class="anchor" id="example-lm_sids"></a>
Working with Source Identifiers</h1>
<p>An example of mapping between source identifiers (SIDs) and SEED identifier codes.</p>
<div class="fragment"><div class="line"><span class="comment">/***************************************************************************</span></div><div class="line"><span class="comment"> * A program illustrating mapping source identifiers and SEED codes</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This file is part of the miniSEED Library.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Copyright (c) 2019 Chad Trabant, IRIS Data Management Center</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is free software; you can redistribute it</span></div><div class="line"><span class="comment"> * and/or modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div><div class="line"><span class="comment"> * version 3 of the License, or (at your option) any later version.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The miniSEED Library is distributed in the hope that it will be</span></div><div class="line"><span class="comment"> * useful, but WITHOUT ANY WARRANTY; without even the implied warranty</span></div><div class="line"><span class="comment"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU Lesser General Public License (GNU-LGPL) for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><span class="comment"> * License along with this software. If not, see</span></div><div class="line"><span class="comment"> * &lt;https://www.gnu.org/licenses/&gt;</span></div><div class="line"><span class="comment"> ***************************************************************************/</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libmseed_8h.html">libmseed.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">map_sid (<span class="keywordtype">char</span> *original_sid)</div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> sid[<a class="code" href="libmseed_8h.html#a35732636583abd22ed0307c5d2576493">LM_SIDLEN</a>];</div><div class="line">  <span class="keywordtype">char</span> network[11];</div><div class="line">  <span class="keywordtype">char</span> station[11];</div><div class="line">  <span class="keywordtype">char</span> location[11];</div><div class="line">  <span class="keywordtype">char</span> channel[11];</div><div class="line">  <span class="keywordtype">int</span> rv;</div><div class="line"></div><div class="line">  <span class="comment">/* Parse network, station, location and channel from SID */</span></div><div class="line">  rv = <a class="code" href="group__string-functions.html#gafbfea7ed4278b28c17da07fa7319b189">ms_sid2nslc</a> (original_sid, network, station, location, channel);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (rv)</div><div class="line">  {</div><div class="line">    printf (<span class="stringliteral">&quot;Error returned ms_sid2nslc()\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Construct SID from network, station, location and channel */</span></div><div class="line">  rv = <a class="code" href="group__string-functions.html#ga58219d2fde492eefb982d659fa3a7b67">ms_nslc2sid</a> (sid, <span class="keyword">sizeof</span>(sid), 0, network, station, location, channel);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (rv &lt;= 0)</div><div class="line">  {</div><div class="line">    printf (<span class="stringliteral">&quot;Error returned ms_nslc2sid()\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  printf (<span class="stringliteral">&quot;Original SID: &#39;%s&#39;\n&quot;</span>, original_sid);</div><div class="line">  printf (<span class="stringliteral">&quot;  network: &#39;%s&#39;, station: &#39;%s&#39;, location: &#39;%s&#39;, channel: &#39;%s&#39;\n&quot;</span>,</div><div class="line">          network, station, location, channel);</div><div class="line">  printf (<span class="stringliteral">&quot;  SID: &#39;%s&#39;\n&quot;</span>, sid);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span></div><div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> *sid;</div><div class="line">  <span class="keywordtype">int</span> idx;</div><div class="line"></div><div class="line">  sid = <span class="stringliteral">&quot;XFDSN:NET_STA_LOC_C_H_N&quot;</span>;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (map_sid (sid))</div><div class="line">  {</div><div class="line">    printf (<span class="stringliteral">&quot;Error with map_sid()\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Map each value give on the command line */</span></div><div class="line">  <span class="keywordflow">if</span> (argc &gt; 1)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">for</span> (idx = 1; idx &lt; argc; idx++)</div><div class="line">    {</div><div class="line">      <span class="keywordflow">if</span> (map_sid (argv[idx]))</div><div class="line">      {</div><div class="line">        printf (<span class="stringliteral">&quot;Error with map_sid()\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">      }</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libmseed" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
