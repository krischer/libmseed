<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmseed: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmseed
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
   <div id="projectbrief">The miniSEED data format library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">libmseed Documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#common-usage">Common usage</a><ul><li class="level2"><a href="#reading">Reading miniSEED data</a><ul><li class="level3"><a href="#reading-records">Reading miniSEED records from files</a></li>
<li class="level3"><a href="#reading-tracelists">Reading miniSEED from files into traces lists</a></li>
<li class="level3"><a href="#reading-buffers">Reading miniSEED from memory</a></li>
</ul>
</li>
<li class="level2"><a href="#writing">Writing miniSEED records</a><ul><li class="level3"><a href="#callback">Callback design</a></li>
<li class="level3"><a href="#writing-files">Writing miniSEED data to files</a></li>
<li class="level3"><a href="#creating-records">Creating miniSEED records</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="common-usage"></a>
Common usage</h1>
<p>This page contains a description of basic library usage for the most common usage cases.</p>
<p>Additionally, the <a class="el" href="page-examples.html">Examples</a> page contains full examples for common use cases, which are also included in the 'examples' directory of the source code distribution.</p>
<h2><a class="anchor" id="reading"></a>
Reading miniSEED data</h2>
<p>A common task is to read a file of miniSEED records and perform some action based on the header values or apply some process to the data samples. There are two patterns to support this in the library, one to iterate over the file record-by-record and another to read all data into a collection of continuous series.</p>
<h3><a class="anchor" id="reading-records"></a>
Reading miniSEED records from files</h3>
<p>The <a class="el" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb" title="Read miniSEED records from a file.">ms3_readmsr()</a> routine will open a specified file and return <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a> structures for each miniSEED record it reads from the file. Called iteratively in a loop, all records are returned in the order discovered.</p>
<p>A code snippet for reading miniSEED from a file record-by-record: <a class="anchor" id="msr3-readmsr-snippet"></a></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main ()</div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> *filename = <span class="stringliteral">&quot;datafile.mseed&quot;</span>;</div><div class="line">  <a class="code" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr = NULL;</div><div class="line">  uint32_t flags = <a class="code" href="group__control-flags.html#ga3ef588c484b70c0a186d16f974e1b4bc">MSF_SKIPNOTDATA</a> &amp; <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line">  <span class="keywordtype">int</span> verbose    = 0;</div><div class="line">  <span class="keywordtype">int</span> retcode;</div><div class="line"></div><div class="line">  <span class="keywordflow">while</span> ((retcode = <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, filename, NULL, NULL, flags, verbose)) == <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">/* Do something with the record here, e.g. print */</span></div><div class="line">    <a class="code" href="group__miniseed-record.html#gaad6b4c5c5194d338f9d89dfe84b44bd9">msr3_print</a> (msr, verbose);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__return-values.html#gaaa6856cc106d8dcd273bdaa7a48082d0">MS_ENDOFFILE</a>)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read %s: %s\n&quot;</span>, filename, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a> (retcode));</div><div class="line"></div><div class="line">  <span class="comment">/* Cleanup memory and close file */</span></div><div class="line">  <a class="code" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb">ms3_readmsr</a> (&amp;msr, NULL, NULL, NULL, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>It is important to call <a class="el" href="group__io-functions.html#ga03bbabe5199fd66152badbf2c15fccbb" title="Read miniSEED records from a file.">ms3_readmsr()</a> for cleanup as illustrated to free memory and close files.</p>
<p>There are more advanced versions of this routine. The <a class="el" href="group__io-functions.html#ga3ab5cb10dcc75ed6f8f8ae51582e056e" title="Read miniSEED records from a file in a thread-safe way.">ms3_readmsr_r()</a> function is a thread-safe version that can be used in threaded programs to read files in parallel. The <a class="el" href="group__io-functions.html#ga1fbe0a7897fd72bbce29297a8fab69a7" title="Read miniSEED records from a file with optional selection.">ms3_readmsr_selection()</a> function is a thread-safe version that can additionally accept <a class="el" href="group__data-selections.html">Data Selections</a> to efficiently return only selected data.</p>
<h3><a class="anchor" id="reading-tracelists"></a>
Reading miniSEED from files into traces lists</h3>
<p>Another option is to read all miniSEED into a <a class="el" href="group__trace-list.html">Trace List</a> without any handling of records. This is done with ms3_readtraces(), which is very useful for quickly reading data for processing. The data are returned in ordered, continuous segments ready for processing.</p>
<p>A code snippet for reading miniSEED from a file into a <a class="el" href="group__trace-list.html">Trace List</a> : <a class="anchor" id="msr3-readtracelist-snippet"></a></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main ()</div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> *filename1    = <span class="stringliteral">&quot;datafile1.mseed&quot;</span>;</div><div class="line">  <span class="keywordtype">char</span> *filename2    = <span class="stringliteral">&quot;datafile2.mseed&quot;</span>;</div><div class="line">  <a class="code" href="group__trace-list.html#struct_m_s3_trace_list">MS3TraceList</a> *mstl = NULL;</div><div class="line">  uint32_t flags     = <a class="code" href="group__control-flags.html#ga3ef588c484b70c0a186d16f974e1b4bc">MSF_SKIPNOTDATA</a> &amp; <a class="code" href="group__control-flags.html#ga95033e92e20f803ae8e3daebca1a2b5b">MSF_UNPACKDATA</a>;</div><div class="line">  <span class="keywordtype">int</span> verbose        = 0;</div><div class="line">  <span class="keywordtype">int</span> retcode;</div><div class="line"></div><div class="line">  retcode = <a class="code" href="group__io-functions.html#ga51d087ffee08118ac1b7686a366e75c0">ms3_readtracelist</a> (&amp;mstl, filename1, -1.0, -1.0, 0, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read %s: %s\n&quot;</span>, filename1, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a> (retcode));</div><div class="line"></div><div class="line">  retcode = <a class="code" href="group__io-functions.html#ga51d087ffee08118ac1b7686a366e75c0">ms3_readtracelist</a> (&amp;mstl, filename2, -1.0, -1.0, 0, flags, verbose);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__return-values.html#ga91727033ca93e4d2b47ecb80243b054d">MS_NOERROR</a>)</div><div class="line">    <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (2, <span class="stringliteral">&quot;Cannot read %s: %s\n&quot;</span>, filename2, <a class="code" href="group__utility-functions.html#gafe52893895543f80af7ad599577881be">ms_errorstr</a> (retcode));</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (!mstl)</div><div class="line">  {</div><div class="line">    fprintf (stderr, <span class="stringliteral">&quot;Error reading file\\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> -1;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Do something with the traces here, e.g. print */</span></div><div class="line">  <a class="code" href="group__trace-list.html#gad6999931a86547276deb85b36145ccd6">mstl3_printtracelist</a> (mstl, 0, verbose, 0);</div><div class="line"></div><div class="line">  <a class="code" href="group__trace-list.html#ga2a436ab4eb7cd653e52e6760c2f51f20">mstl3_free</a> (&amp;mstl, 1);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>There are more advanced versions of this routine. The <a class="el" href="group__io-functions.html#ga0633ce3ce3a3eaa2de9540d70410d927" title="Read miniSEED from a file into a trace list, with time range selection.">ms3_readtracelist_timewin()</a> function allows data to be limited to a specific time range while reading. The <a class="el" href="group__io-functions.html#gae0cba40ee8021bcb8bcd3b35042f7b02" title="Read miniSEED from a file into a trace list, with selection filtering.">ms3_readtracelist_selection()</a> can additionally accept <a class="el" href="group__data-selections.html">Data Selections</a> to efficiently return only selected data.</p>
<h3><a class="anchor" id="reading-buffers"></a>
Reading miniSEED from memory</h3>
<p>If an application is not designed to read miniSEED from files the library provides functions functionality to read data from memory. The <a class="el" href="group__trace-list.html#ga592d4a0909d6961f745098a556635b8f" title="Parse miniSEED from a buffer and populate a MS3TraceList.">mstl3_readbuffer()</a> function will read all data from a buffer into a <a class="el" href="group__trace-list.html">Trace List</a>. The low-level functions <a class="el" href="group__miniseed-record.html#gabce57fe1524c0917f8c416571858b7aa" title="Detect miniSEED record in buffer.">ms3_detect()</a> and <a class="el" href="group__miniseed-record.html#ga685b3796656bcf24c2f417c94d3631f6" title="Parse miniSEED from a buffer.">msr3_parse()</a> can be used to detect and parse miniSEED records in memory buffers.</p>
<h2><a class="anchor" id="writing"></a>
Writing miniSEED records</h2>
<p>Another common task is to create miniSEED records. There are two patterns to support this in the library: one is to write data from library containers to files and another to create records and provide them back to the caller in a memory buffer via a callback function.</p>
<h3><a class="anchor" id="callback"></a>
Callback design</h3>
<p>If not writing directly to files, the packing interfaces use a callback design, where the caller specifies a function that will be called for every record that is created. It is the responsibility of the callback function to handle the record before returning. This design allows a program to do whatever is needed with generated miniSEED, i.e. write to files, send over the network, or even injection of more information.</p>
<h3><a class="anchor" id="writing-files"></a>
Writing miniSEED data to files</h3>
<p>The library supports writing miniSEED directly to files from either <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a> or <a class="el" href="group__trace-list.html#struct_m_s3_trace_list" title="Container for a collection of continuous trace segment, linkable.">MS3TraceList</a> containers using <a class="el" href="group__io-functions.html#ga4614ddc9bd829c497dc12d52f7157af4" title="Write miniSEED from an MS3Record container to a file.">msr3_writemseed()</a> or <a class="el" href="group__io-functions.html#ga8e36406b0b684fb9efec940065b71ee4" title="Write miniSEED from an MS3TraceList container to a file.">mstl3_writemseed()</a> respectively.</p>
<p>A code snippet for writing miniSEED to a file from an <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a> using <a class="el" href="group__io-functions.html#ga4614ddc9bd829c497dc12d52f7157af4" title="Write miniSEED from an MS3Record container to a file.">msr3_writemseed()</a>: <a class="anchor" id="msr3-writemseed-snippet"></a></p><div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">  <span class="keywordtype">int</span> packedrecords;</div><div class="line">  <span class="keywordtype">int</span> verbose = 0;</div><div class="line">  <span class="keywordtype">char</span> *msfile = <span class="stringliteral">&quot;output.mseed&quot;</span>;</div><div class="line">  int32_t datasamples[] = {0,1,2,3,4,5,6,7,8,9,10};</div><div class="line">  <a class="code" href="group__miniseed-record.html#struct_m_s3_record">MS3Record</a> *msr;</div><div class="line"></div><div class="line">  msr = <a class="code" href="group__miniseed-record.html#ga23234c20f2e74e5c065d2b654a6602e5">msr3_init</a> (NULL);</div><div class="line"></div><div class="line">  <span class="comment">/* Populate MS3Record values */</span></div><div class="line">  strcpy (msr-&gt;<a class="code" href="group__miniseed-record.html#ac93add454993eff521bc94900bf40ac1">sid</a>, <span class="stringliteral">&quot;XX_TEXT__B_H_E&quot;</span>);</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a418616cb8cea93ef6e70a88b72f11ab0">formatversion</a> = 3;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a47d7e72d144305b788d69e3ba859f087">reclen</a> = 512;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a63ee8e965be55863765c56016873be17">encoding</a> = <a class="code" href="group__encoding-values.html#ga88038a2002e473c74440f7fae5f0dc74">DE_STEIM2</a>;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a8ed5d39b9df3bfa9dd953c33d27ac73e">starttime</a> = <a class="code" href="group__time-related.html#gaa9fb97cc8dc5d8b94f2b0e6f663c950c">ms_timestr2nstime</a> (<span class="stringliteral">&quot;2018-12-01T00:00:00.000000000&quot;</span>);</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a7578e312e666fcc80cc07fd324201d4e">samprate</a> = 20.0;</div><div class="line"></div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = datasamples;  <span class="comment">/* pointer to 32-bit integer data samples */</span></div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a7871a3c78d7ecb7c30c6526aa1fd9718">numsamples</a> = 11;</div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a866a8640500756bc031ef7897fc1eeb2">sampletype</a> = <span class="charliteral">&#39;i&#39;</span>;  <span class="comment">/* declare data type to be 32-bit integers */</span></div><div class="line"></div><div class="line">  <span class="comment">/* Write all data in MS3Record to output file, using MSF_FLUSHDATA flag */</span></div><div class="line">  packedrecords = <a class="code" href="group__io-functions.html#ga4614ddc9bd829c497dc12d52f7157af4">msr3_writemseed</a> (msr, msfile, 1, <a class="code" href="group__control-flags.html#gaae2d9bb856575a556a4ac4dd1ce5f8c5">MSF_FLUSHDATA</a>, verbose);</div><div class="line"></div><div class="line">  <a class="code" href="group__logging.html#ga46faadabbf8bdb25a2c2db7b70092dba">ms_log</a> (0, <span class="stringliteral">&quot;Wrote %d records to %s\n&quot;</span>, packedrecords, msfile);</div><div class="line"></div><div class="line">  <span class="comment">/* Disconnect datasamples pointer, otherwise msr3_free() will attempt to free() it */</span></div><div class="line">  msr-&gt;<a class="code" href="group__miniseed-record.html#a1c3a46dfc681da1bf5199b48bf9c55d3">datasamples</a> = NULL;</div><div class="line"></div><div class="line">  <a class="code" href="group__miniseed-record.html#ga72e0d55e9200bbdda71d157cd8939d4e">msr3_free</a> (&amp;msr);</div><div class="line">}</div></div><!-- fragment --><h3><a class="anchor" id="creating-records"></a>
Creating miniSEED records</h3>
<p>Records can be generated from data in either <a class="el" href="group__miniseed-record.html#struct_m_s3_record" title="miniSEED record container">MS3Record</a> or <a class="el" href="group__trace-list.html#struct_m_s3_trace_list" title="Container for a collection of continuous trace segment, linkable.">MS3TraceList</a> containers using, respectively, <a class="el" href="group__miniseed-record.html#gaa649330804f08b4d4cef9c0b1d8f7867" title="Pack data into miniSEED records.">msr3_pack()</a> or and <a class="el" href="group__trace-list.html#ga80474d2fd69cf377305226dc9ba05b65" title="Pack MS3TraceList data into miniSEED records.">mstl3_pack()</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- GitHub corner from https://github.com/tholman/github-corners -->
<a href="https://github.com/iris-edu/libmseed" class="github-corner" aria-label="View source on GitHub"><svg width="75" height="75" viewBox="0 0 250 250" style="fill:#442487; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<a href="https://ds.iris.edu"><img style="position: absolute; top: 0; border: 0; right: 75px; height:75px;" src="https://www.iris.edu/hq/files/publications/logos/iris_color_screen.png"></a>
